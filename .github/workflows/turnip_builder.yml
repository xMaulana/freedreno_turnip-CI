name: Turnip Gen8 Auto-Build

on:
  workflow_dispatch: # BotÃ£o manual
  schedule:
    # Roda a cada 12 horas (ex: 00:00 e 12:00 UTC)
    - cron: '0 */12 * * *'

jobs:
  build-drivers:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout CI Repo
        uses: actions/checkout@v3

      - name: Setup Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y meson ninja-build patchelf unzip flex bison git perl python3-pip
          pip3 install mako

      - name: Calculate Version
        id: version
        # Run 1 = V11, Run 2 = V12, etc.
        run: echo "V_NUM=$((GITHUB_RUN_NUMBER + 10))" >> $GITHUB_ENV

      - name: Make Script Executable
        run: chmod +x turnip_builder.sh

      # --- BUILD 1: STANDARD (gen8-hacks) ---
      - name: Build V${{ env.V_NUM }} (Standard)
        run: ./turnip_builder.sh STD ${{ env.V_NUM }}

      # --- BUILD 2: YUCK (gen8-yuck) ---
      - name: Build V${{ env.V_NUM }}+Yuck (Yuck Branch)
        run: ./turnip_builder.sh YUCK ${{ env.V_NUM }}

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Turnip-Gen8-V${{ env.V_NUM }}-Pack
          path: |
            turnip_workdir_STD/*.zip
            turnip_workdir_YUCK/*.zip

      - name: Release
        uses: softprops/action-gh-release@v1
        if: github.event_name == 'workflow_dispatch' || github.event_name == 'schedule'
        with:
          tag_name: V${{ env.V_NUM }}
          name: Turnip Gen8 V${{ env.V_NUM }}
          body: |
            Automated Build (Every 12h)
            
            **Contains:**
            - **Mesa Turnip Gen8 V${{ env.V_NUM }}.zip**: Base RobClark + Standard Hacks (gen8-hacks) + DXVK Fix.
            - **Mesa Turnip Gen8 V${{ env.V_NUM }}+Yuck.zip**: Base RobClark + **Yuck Hacks (gen8-yuck)** + DXVK Fix.
            
            *Compiled for Android 16 (SDK 36).*
          files: |
            turnip_workdir_STD/*.zip
            turnip_workdir_YUCK/*.zip
